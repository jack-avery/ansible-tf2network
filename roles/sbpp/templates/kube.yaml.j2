apiVersion: v1
kind: Pod
metadata:
  name: ansible-tf2network_{{ network_shortname }}-metrics
spec:
  containers:
    - name: "sourcebans_{{ network_shortname }}"
      image: docker.io/crinis/sourcebans:2.0.0
      env:
        - INSTALL: "false"
      ports:
        - containerPort: 8080
          hostPort: {{ sbpp_html_port }}
          protocol: TCP
      volumes:
        - sourcebans-{{ network_shortname }}:/var/www/html/
    - name: "db_{{ network_shortname }}"
      image: docker.io/library/mariadb:10
      env:
        - MYSQL_USER: sourcebans
        - MYSQL_PASWORD: {{ sbpp_user_password }}
        - MYSQL_DATABASE: sourcebans
        - MYSQL_ROOT_PASSWORD: {{ sbpp_root_password }}
      volumes:
        - mariadb-{{ network_shortname }}:/var/lib/mysql
        - /home/tf2server/sbpp/50-server.cnf:/etc/mysql/mariadb.conf.d/50-server.cnf:ro
    - name: "landing_{{ network_shortname }}"
      image: docker.io/linuxserver/openssh-server
      environment:
        - PUBLIC_KEY_DIR=/authorized_keys
        - USER_NAME=sbpp_user
      volumes:
        - /home/tf2server/sbpp/{{ network_shortname }}/keys:/authorized_keys
        - /home/tf2server/sbpp/{{ network_shortname }}/config:/config
        - /home/tf2server/ssh-init:/custom-cont-init.d:ro
      ports:
        - containerPort: 2222
          hostPort: {{ sbpp_host_ssh_port }}
          protocol: TCP
