---
- name: Perform setup
  ansible.builtin.include_tasks: setup.yml

- name: Create build directory
  ansible.builtin.file:
    path: ~/sbpp
    state: directory
    mode: 0755

- name: Create network directory
  ansible.builtin.file:
    path: ~/sbpp/{{ network_shortname }}
    state: directory
    mode: 0755

- name: Create ssh-init directory
  ansible.builtin.file:
    path: ~/ssh-init
    state: directory
    mode: 0755

- name: Transfer 50-server.cnf
  copy:
    src: 50-server.cnf
    dest: ~/sbpp/50-server.cnf
    mode: 0644

- name: Transfer sshd_config
  copy:
    src: sshd_config.sh
    dest: ~/ssh-init/sshd_config.sh
    mode: 0644

- name: Template kube.j2
  ansible.builtin.template:
    src: "kube.yaml.j2"
    dest: "~/sbpp/{{ network_shortname }}/kube.yaml"
    mode: 0700

- name: systemd user daemon reload
  ansible.builtin.systemd_service:
    scope: user
    daemon_reload: true
