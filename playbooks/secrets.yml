---
- name: Include secret all vars.
  ignore_errors: true # don't freak out if it's not there
  ansible.builtin.include_vars: 
    file: "../group_vars/all.secret.yml"

- name: Stat groups
  ansible.builtin.stat:
    path: "../group_vars/{{ item }}.secret.yml"
  loop: "{{ group_names }}"
  register: stat
  delegate_to: localhost

- name: Include secret group_vars.
  ansible.builtin.include_vars: 
    file: "../group_vars/{{ item.item }}.secret.yml"
  when: item.stat.exists
  loop: "{{ stat.results }}"

- name: Include secret host_vars.
  ignore_errors: true
  ansible.builtin.include_vars:
    file: "../host_vars/{{ inventory_hostname }}.secret.yml"
